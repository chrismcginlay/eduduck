{% extends "courses/base_course.html" %}
{% load staticfiles %}
{% load tz %}

{% block contentheading %}
{{ course.course_name }}
{% endblock contentheading %}

{% block content %}

    <section id="zone1">
        <h3>{{ course.course_name }}, {{ course.course_organiser }}</h3>
        <p>Hi, and welcome to {{ course.course_name }}</p>
        <p class="abstract">
            {% for v in course.video_set.all %}
            <iframe width="280" height="158" src='{{ v.url }}' 
                frameborder="0" allowfullscreen></iframe>
            <br />
            {% endfor %}
            {{ course.course_abstract }}
        </p>
        <p>There 
        {{course.lesson_set.count|pluralize:"is,are"}} {{course.lesson_set.count}} 
        lesson{{course.lesson_set.count|pluralize:",s"}} in this course.</p>
    
        {% regroup course.lesson_set.all by lesson.lesson_code as lesson_list %}
        {% for lesson in course.lesson_set.all %}
        <article>
            <h4>{{ lesson.lesson_code}}; {{ lesson.lesson_name }}</h4>
            <a href='{{ lesson.get_absolute_url }}'>
                {{ lesson.lesson_name }}
            </a>
            <p class="abstract">{{ lesson.abstract}} 
                <a href='{{ lesson.get_absolute_url }}'>
                Go to lesson</a>
            </p>
        </article>
        {% empty %}
        <article>
        <h4>No Lessons</h4>
            <p class="abstract">{{ course.course_oraganiser }} 
            hasn't added any lessons yet!</p>
        </article>
        {% endfor %}
    </section>

    <section id="zone2">
        {% if status == "auth_reg" %}
            <h3>Your Progress</h3>
            <p>Current status: {{ uc.get_status }}</p>
            {% if uc.get_status == 'active' %}
            <form action='' method='post'>{% csrf_token %}
                <input type="submit" name="course_complete" value="Complete"
                title="Mark the course as complete">
                <input type="submit" name="course_withdraw" value="Withdraw"
                title="Withdraw from the course">
            </form>  
            {% else %}
            <form action='' method='post'>{% csrf_token %}
                <input type="submit" name="course_reopen" value="Re-open">
            </form>  
            {% endif %}
            <ol>{% for event in history %}
                <li>{{ event.1 }} on {{ event.0|localtime }}</li>
            {% endfor %}</ol>
            <h4>Lessons Visited</h4>
            <table border='1'>
            <thead>
            <tr><th>Status</th><th>Lesson</th></tr>
            </thead>
            <tbody>
                {% for lesson, ul in lessons %}<tr><td>
                    {% if ul.completed %}Completed
                    {% elif ul.visited %}Visited
                    {% endif %}
                    </td><td>{{ lesson.lesson_name }}</td></tr>
                {% endfor %}
            </tbody>
            </table>
        {% elif status == "auth_noreg" %}
            <h3>Enroll Here</h3>
            <form action='' method='post'>{% csrf_token %}
                <input type="submit" name="course_register" value="Register">
            </form>
        {% else %}
            <h3>Join Eduduck</h3>
            <p>Join Eduduck and enroll on this course</p>
        {% endif %}
        <h3>Course News</h3>
        <p>Combined news feed, possibly user configurable forum RSS, 
        twitter, G+, Facebook etc. (Students often set up own groups</p>
    </section>

{% endblock content %}